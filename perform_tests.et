#!./build/bin/et

import std.fs;
import std.os;
import std.str;
import std.term;
import std.time;
import std.vec;

files = fs.dir_entries( 'tests', fs.ent.RECURSE, '(.*)\\.et' );

p = 0;
f = 0;

start = time.now();
tmp_start = start;

for file in files.iter() {
	cprint( '{c}test{0}: {y}', file, '{0} ... ' );
	flush_out();
	res = os.exec( __PROG__ + ' ' + file + ' test' ) == 0;
	tmp_diff = time.now() - tmp_start;
	if res {
		cprintln( '{g}', tmp_diff.msecs(), ' ms{0}' );
		p += 1;
	} else {
		cprintln( '{r}', tmp_diff.msecs(), ' ms{0}' );
		f += 1;
	}
	tmp_start = time.now();
}

diff = time.now() - start;

cprintln( '{y}OS{0}: {m}', os.name, '{0}, {y}Passed{0}: {g}', p, '{0}, {y}Failed{0}: {r}', f, '{0}, {y}Total Time{0}: {b}', diff.msecs(), ' ms{0}' );
exit( f );
